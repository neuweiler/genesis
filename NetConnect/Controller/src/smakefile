###############################################################################
#
#	SMakefile
#
#	Makefile for the `SMake' utility required to build `NetConnect'
#
#	1996 by Michael Neuweiler
#
###############################################################################

.c.o:
	sc $(CFLAGS) $(GST) $(OPTIONS) NOEXTDEF $*.c

.asm.o:
	ASM -D $*.asm

CPU		= ANY
#CPU		= 68030

#OPTIMIZE	= OPT NOOPTINLOCAL

OPTIONS	= CPU=$(CPU) $(OPTIMIZE)

GST		= GSTIMM GST=includes.gst

CFLAGS	= MCCONS ERRREXX STRMERGE NOSTKCHK IDLEN=65 NOVER IGN=105 NOMINC CNEST STREQ DEF=_M$(CPU) NOICONS
#CFLAGS	= MCCONS ERRREXX STRMERGE NOSTKCHK IDLEN=65 NOVER IGN=105 NOMINC CNEST STREQ DEF=_M$(CPU) NOICONS DBG=FULL

LFLAGS	= ND SC SD NOICONS MAXHUNK 100000
#LFLAGS	= SC SD NOICONS MAXHUNK 100000

OBJS		= main.o globals.o mui1.o mui2.o amiga.o fixpath.o
LIBS		= lib:amiga.lib lib:sc.lib

all:	 includes.gst NetConnectStrings.h default_icon.bh logo.bh NetConnect

includes.gst:	includes.h
		GST >NIL: UNLOAD $@
		SC NOOBJNAME IDLEN=65 NOVERSION MAKEGST=$@ includes.h
		GST $@

NetConnectStrings.h: NetConnectStrings.cd
	cat2h NetConnectStrings.cd NetConnectStrings.h

default_icon.bh: default_icon.iff
	brush2c default_icon.iff >default_icon.bh

logo.bh: logo.iff
	brush2c logo.iff >logo.bh

NetConnect:	$(OBJS)
   SLINK WITH T:NetConnect.WITH <<!(T:NetConnect.WITH)
		FROM	lib:start.o $(OBJS)
		TO		NetConnect
		LIB	$(LIBS)
		MAP netconnect.map H
		$(LFLAGS)
	<

globals.o:	globals.c	NetConnect.h NetConnectStrings.h	logo.bh default_icon.bh
	sc $(CFLAGS) $(GST) $(OPTIONS) globals.c
main.o:		main.c		NetConnect.h NetConnectStrings.h globals.c
mui1.o:		mui1.c		NetConnect.h NetConnectStrings.h globals.c logo.bh default_icon.bh
mui2.o:		mui2.c		NetConnect.h NetConnectStrings.h globals.c logo.bh default_icon.bh
amiga.o:		amiga.c		NetConnect.h NetConnectStrings.h globals.c
fixpath.o:	fixpath.c
