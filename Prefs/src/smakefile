###############################################################################
#
#	SMakefile
#
#	Makefile for the `SMake' utility required to build `AmiTCP Prefs'
#
#	1996 by Michael Neuweiler
#
###############################################################################

.c.o:
	sc $(CFLAGS) $(GST) $(OPTIONS) NOEXTDEF $*.c

.asm.o:
	ASM -D $*.asm

CPU		= ANY
#CPU		= 68030
DEMO		= DEF=DEMO
#BETA		= DEF=BETA
#DEBUG	= DBG=LINE
OPTIMIZE	= OPT OPTTIME NOOPTINLOCAL

OPTIONS	= CPU=$(CPU) $(OPTIMIZE)
GST		= GSTIMM GST=includes.gst

CFLAGS	= MCCONS ERRREXX STRMERGE NOSTKCHK IDLEN=65 NOVER IGN=105 NOMINC CNEST STREQ NOICONS DEF=_M$(CPU) $(DEMO) $(BETA) $(DEBUG)

LFLAGS	= ND SC SD NOICONS MAXHUNK 100000
#LFLAGS	= SC SD NOICONS MAXHUNK 100000

OBJS		= globals.o main.o Stackcall.o mui1.o mui2.o amiga.o
LIBS		= lib:amiga.lib lib:sc.lib

all:	 includes.gst locale/Strings.h locale/empty.ct locale:catalogs/deutsch/AmiTCPPrefs.catalog logo.bh AmiTCPPrefs

includes.gst:	includes.h
		GST >NIL: UNLOAD $@
		SC NOOBJNAME IDLEN=65 NOVERSION MAKEGST=$@ includes.h
		GST $@

logo.bh: logo.iff
	brush2c logo.iff >logo.bh

locale/Strings.h: locale/Strings.cd
	cat2h locale/Strings.cd locale/Strings.h
locale/empty.ct : locale/Strings.cd
	sc:c/FlexCat locale/Strings.cd NEWCTFILE locale/empty.ct
locale:catalogs/deutsch/AmiTCPPrefs.catalog : locale/deutsch.ct
	sc:c/FlexCat locale/Strings.cd locale/deutsch.ct CATALOG locale:catalogs/deutsch/AmiTCPPrefs.catalog
	c:avail >nil: flush

AmiTCPPrefs:	$(OBJS)
   SLINK WITH T:AmiTCPPrefs.WITH <<!(T:AmiTCPPrefs.WITH)
		FROM	lib:start.o $(OBJS)
		TO		AmiTCPPrefs
		LIB	$(LIBS)
		MAP	AmiTCPPrefs.map H
		$(LFLAGS)
	<

globals.o:	globals.c	mui.h rev.h AmiTCPPrefs.h locale/Strings.h
	sc $(CFLAGS) $(GST) $(OPTIONS) globals.c
main.o:		main.c		mui.h rev.h AmiTCPPrefs.h locale/Strings.h globals.c
mui1.o:		mui1.c		mui.h rev.h AmiTCPPrefs.h locale/Strings.h globals.c
mui2.o:		mui2.c		mui.h rev.h AmiTCPPrefs.h locale/Strings.h globals.c
amiga.o:		amiga.c		mui.h rev.h AmiTCPPrefs.h locale/Strings.h globals.c
